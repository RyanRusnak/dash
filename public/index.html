<!DOCTYPE html>
<html lang="en">
<head>

	<!-- start: Meta -->
	<meta charset="utf-8">
	<title>OAR Classify</title>
	<meta name="description" content="Classification Dashboard for OAR">
	<meta name="author" content="Łukasz Holeczek">
	<!-- end: Meta -->

	<!-- start: Mobile Specific -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- end: Mobile Specific -->

	<!-- start: CSS -->

	<!-- bootstrap -->
	<link href="assets/css/bootstrap.min.css" rel="stylesheet">

	<!-- page css files -->
	<link href="assets/css/font-awesome.min.css" rel="stylesheet">
	<link href="assets/css/jquery-ui-1.10.3.custom.min.css" rel="stylesheet">
	<link href="assets/css/fullcalendar.css" rel="stylesheet">
	<link href="assets/css/jquery.gritter.css" rel="stylesheet">
	<!-- <link href="assets/css/glyphicons.css" rel="stylesheet"> -->

	<!-- main style -->
	<link href="assets/css/style.min.css" rel="stylesheet">

	<link href="/css/jquery.gridster.min.css" rel="stylesheet">
	<link href="/css/nv.d3.min.css" rel="stylesheet">
	<!--[if lt IE 9 ]>
		<link href="assets/css/style-ie.css" rel="stylesheet">
	<![endif]-->

	<!-- end: CSS -->


	<!-- The HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>

	  	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<script src="assets/js/respond.min.js"></script>

	<![endif]-->

	<!-- start: Favicon -->
	<link rel="shortcut icon" href="http://localhost:8888/bootstrap/perfectum2/img/favicon.ico">
	<!-- end: Favicon -->

</head>

<body>

	<!-- start: Header -->
	<div class="navbar">
		<div class="container">
			<button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".sidebar-nav.nav-collapse">
			      <span class="icon-bar"></span>
			      <span class="icon-bar"></span>
			      <span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="index.html"> <img alt="Perfectum Dashboard" src="assets/img/logo20.png" /> <span>OAR Dashboard</span></a>

			<!-- start: Header Menu -->
			<div class="header-nav">
				<ul class="nav navbar-nav pull-right">
					<li class="dropdown hidden-xs">
						<a class="btn dropdown-toggle" data-toggle="dropdown" href="index.html#">
							<i class="fa fa-warning"></i><span class="label label-success hidden-xs">11</span>
						</a>
						<ul class="dropdown-menu notifications">
							<li>
								<span class="dropdown-menu-title">You have 11 notifications</span>
							</li>
                        	<li>
                                <a href="index.html#">
									<i class="fa fa-user"></i> <span class="message">New user registration</span> <span class="time">1 min</span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<i class="fa fa-comment"></i> <span class="message">New comment</span> <span class="time">7 min</span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<i class="fa fa-comment"></i> <span class="message">New comment</span> <span class="time">8 min</span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<i class="fa fa-comment"></i> <span class="message">New comment</span> <span class="time">16 min</span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<i class="fa fa-user"></i> <span class="message">New user registration</span> <span class="time">36 min</span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<i class="fa fa-shopping-cart"></i> <span class="message">2 items sold</span> <span class="time">1 hour</span>
                                </a>
                            </li>
							<li class="warning">
                                <a href="index.html#">
									<i class="fa fa-user"></i> <span class="message">User deleted account</span> <span class="time">2 hour</span>
                                </a>
                            </li>
							<li class="warning">
                                <a href="index.html#">
									<i class="fa fa-shopping-cart"></i> <span class="message">Transaction was canceled</span> <span class="time">6 hour</span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<i class="fa fa-comment"></i> <span class="message">New comment</span> <span class="time">yesterday</span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<i class="fa fa-user"></i> <span class="message">New user registration</span> <span class="time">yesterday</span>
                                </a>
                            </li>
                            <li>
                        		<a class="dropdown-menu-sub-footer">View all notifications</a>
							</li>
						</ul>
					</li>
					<!-- start: Notifications Dropdown -->
					<li class="dropdown hidden-xs">
						<a class="btn dropdown-toggle" data-toggle="dropdown" href="index.html#">
							<i class="fa fa-tasks"></i> <span class="label label-warning hidden-xs">17</span>
						</a>
						<ul class="dropdown-menu tasks">
							<li>
								<span class="dropdown-menu-title">You have 17 tasks in progress</span>
                        	</li>
							<li>
                                <a href="index.html#">
									<span class="header">
										<span class="title">iOS Development</span>
										<span class="percent"></span>
									</span>
                                    <div class="taskProgress progressSlim progressYellow">80</div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
									<span class="header">
										<span class="title">Android Development</span>
										<span class="percent"></span>
									</span>
                                    <div class="taskProgress progressSlim progressYellow">47</div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
									<span class="header">
										<span class="title">Django Project For Google</span>
										<span class="percent"></span>
									</span>
                                    <div class="taskProgress progressSlim progressYellow">32</div>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<span class="header">
										<span class="title">SEO for new sites</span>
										<span class="percent"></span>
									</span>
                                    <div class="taskProgress progressSlim progressYellow">63</div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
									<span class="header">
										<span class="title">New blog posts</span>
										<span class="percent"></span>
									</span>
                                    <div class="taskProgress progressSlim progressYellow">80</div>
                                </a>
                            </li>
							<li>
                        		<a class="dropdown-menu-sub-footer">View all tasks</a>
							</li>
						</ul>
					</li>
					<!-- end: Notifications Dropdown -->
					<!-- start: Message Dropdown -->
					<li class="dropdown hidden-xs">
						<a class="btn dropdown-toggle" data-toggle="dropdown" href="index.html#">
							<i class="fa fa-envelope"></i> <span class="label label-success hidden-xs">9</span>
						</a>
						<ul class="dropdown-menu messages">
							<li>
								<span class="dropdown-menu-title">You have 9 messages</span>
							</li>
                        	<li>
                                <a href="index.html#">
									<span class="avatar"><img src="assets/img/avatar.jpg" alt="Avatar"></span>
									<span class="header">
										<span class="from">
									    	Łukasz Holeczek
									     </span>
										<span class="time">
									    	6 min
									    </span>
									</span>
                                    <span class="message">
                                        Lorem ipsum dolor sit amet consectetur adipiscing elit, et al commore
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
									<span class="avatar"><img src="assets/img/avatar2.jpg" alt="Avatar"></span>
									<span class="header">
										<span class="from">
									    	Megan Abott
									     </span>
										<span class="time">
									    	56 min
									    </span>
									</span>
                                    <span class="message">
                                        Lorem ipsum dolor sit amet consectetur adipiscing elit, et al commore
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
									<span class="avatar"><img src="assets/img/avatar3.jpg" alt="Avatar"></span>
									<span class="header">
										<span class="from">
									    	Kate Ross
									     </span>
										<span class="time">
									    	3 hours
									    </span>
									</span>
                                    <span class="message">
                                        Lorem ipsum dolor sit amet consectetur adipiscing elit, et al commore
                                    </span>
                                </a>
                            </li>
							<li>
                                <a href="index.html#">
									<span class="avatar"><img src="assets/img/avatar4.jpg" alt="Avatar"></span>
									<span class="header">
										<span class="from">
									    	Julie Blank
									     </span>
										<span class="time">
									    	yesterday
									    </span>
									</span>
                                    <span class="message">
                                        Lorem ipsum dolor sit amet consectetur adipiscing elit, et al commore
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
									<span class="avatar"><img src="assets/img/avatar5.jpg" alt="Avatar"></span>
									<span class="header">
										<span class="from">
									    	Jane Sanders
									     </span>
										<span class="time">
									    	Jul 25, 2012
									    </span>
									</span>
                                    <span class="message">
                                        Lorem ipsum dolor sit amet consectetur adipiscing elit, et al commore
                                    </span>
                                </a>
                            </li>
							<li>
                        		<a class="dropdown-menu-sub-footer">View all messages</a>
							</li>
						</ul>
					</li>
					<!-- end: Message Dropdown -->
					<li>
						<a class="btn" href="index.html#">
							<i class="fa fa-wrench"></i>
						</a>
					</li>
					<!-- start: User Dropdown -->
					<li class="dropdown hidden-xs">
						<a class="btn dropdown-toggle" data-toggle="dropdown" href="index.html#">
							<i class="fa fa-user"></i>
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu">
							<li><a href="index.html#"><i class="fa fa-user"></i> Profile</a></li>
							<li><a href="login.html"><i class="fa fa-off"></i> Logout</a></li>
						</ul>
					</li>
					<!-- end: User Dropdown -->
				</ul>
			</div>
			<!-- end: Header Menu -->

		</div>
	</div>
	<!-- start: Header -->

		<div class="container">
		<div class="row">
					<!-- start: Main Menu -->
			<div class="col-sm-2 main-menu-span">
				<div class="sidebar-nav nav-collapse collapse navbar-collapse">
					<ul class="nav nav-tabs nav-stacked main-menu">
						<li><a href="index.html"><i class="fa fa-home icon"></i><span class="hidden-sm"> Dashboard</span></a></li>
						<li><a href="grants_page.html"><i class="fa fa-eye"></i><span class="hidden-sm"> Grants</span></a></li>
						<li><a href="tags_page.html"><i class="fa fa-eye"></i><span class="hidden-sm"> Tags</span></a></li>
						<li><a href="charts.html"><i class="fa fa-bar-chart-o"></i><span class="hidden-sm"> Impac II Analysis</span></a></li>
						<li><a href="ui.html"><i class="fa fa-eye"></i><span class="hidden-sm"> Announcements</span></a></li>
					</ul>
				</div><!--/.well -->
			</div><!--/col-->
			<!-- end: Main Menu -->

			<noscript>
				<div class="alert alert-block col-sm-10">
					<h4 class="alert-heading">Warning!</h4>
					<p>You need to have <a href="http://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a> enabled to use this site.</p>
				</div>
			</noscript>

			<div id="content" class="col-sm-10">
			<!-- start: Content -->

			<div>
				<hr>
				<ul class="breadcrumb">
					<li><a href="index.html#">Home</a></li>
					<li><a href="index.html#">Dashboard</a></li>
				</ul>
				<hr>
			</div>

			<div class="row circleStats">

				<div class="col-md-2 col-sm-4 col-xs-6">
                	<div class="circleStatsItem red">
						<i class="fa fa-bullseye"></i>
						<span class="plus">+</span>
						<span class="percent">%</span>
                    	<input type="text" value="58" class="orangeCircle" />
                	</div>
					<div class="box-small-title">Grants Funded</div>
				</div><!--/col-->

				<div class="col-md-2 col-sm-4 col-xs-6">
                	<div class="circleStatsItem blue">
                    	<i class="fa  fa-bullhorn"></i>
						<span class="plus">+</span>
						<span class="percent">%</span>
                    	<input type="text" value="8" class="blueCircle" />
                	</div>
					<div class="box-small-title">Total Budget Spent</div>
				</div><!--/col-->

				<div class="col-md-2 col-sm-4 col-xs-6">
					<div class="circleStatsItem yellow">
                    	<i class="fa  fa-user"></i>
						<span class="plus">+</span>
						<span class="percent">%</span>
                    	<input type="text" value="12" class="yellowCircle" />
                	</div>
					<div class="box-small-title">New users</div>
				</div><!--/col-->

				<div class="col-md-2 col-sm-4 col-xs-6">
					<div class="circleStatsItem pink">
                    	<i class="fa  fa-globe"></i>
						<span class="plus">+</span>
						<span class="percent">%</span>
                    	<input type="text" value="23" class="pinkCircle" />
                	</div>
					<div class="box-small-title">Visits</div>
				</div><!--/col-->

				<div class="col-md-2 col-sm-4 col-xs-6">
                	<div class="circleStatsItem green">
                    	<i class="fa  fa-bar-chart-o"></i>
						<span class="plus">+</span>
						<span class="percent">%</span>
                    	<input type="text" value="34" class="greenCircle" />
                	</div>
					<div class="box-small-title">Income</div>
				</div><!--/col-->

				<div class="col-md-2 col-sm-4 col-xs-6">
					<div class="circleStatsItem lightorange">
                    	<i class="fa  fa-shopping-cart"></i>
						<span class="plus">+</span>
						<span class="percent">%</span>
                    	<input type="text" value="42" class="lightOrangeCircle" />
                	</div>
					<div class="box-small-title">Sales</div>
				</div><!--/col-->

			</div><!--/row-->

			<hr>

			<div class="row">
				<div class="gridster">
				  <ul class="list-unstyled">
				  	<li data-row="1" data-col="1" data-sizex="2" data-sizey="2">
				      <div class="panel panel-default">
				        <div class="panel-heading"><h3 class="panel-title">Current Submissions FY2014</h3></div>
				        <div class="panel-body"><div id="chart4" class="chart bar" data-id="starting"><svg style="height:200px;"></svg></div></div>
				      </div>
				    </li>
				    <li data-row="1" data-col="2" data-sizex="2" data-sizey="2">
				      <div class="panel panel-default">
				        <div class="panel-heading"><h3 class="panel-title">Dollars expiring by year</h3></div>
				        <div class="panel-body"><div id="chart2" class="chart bar" data-id="expiringDollars"><svg style="height:200px;"></svg></div></div>
				      </div>
				    </li>
				    <li data-row="2" data-col="1" data-sizex="2" data-sizey="2">
				      <div class="panel panel-default">
				        <div class="panel-heading"><h3 class="panel-title">Not Yet Reviewed FY2014</h3></div>
				        <div class="panel-body"><div id="chart3" class="chart pie" data-id="status"><svg style="height:200px;"></svg></div></div>
				      </div>
				    </li>
				    <li data-row="2" data-col="2" data-sizex="2" data-sizey="2">
				      <div class="panel panel-default">
				        <div class="panel-heading"><h3 class="panel-title">Projects Last Updated</h3></div>
				        <div class="panel-body"><div id="chart5" class="chart bar" data-id="last-updated"><svg style="height:200px; width:200px;"></svg></div></div>
				      </div>
				    </li>
				    <li data-row="3" data-col="1" data-sizex="2" data-sizey="2">
				      <div class="panel panel-default">
				        <div class="panel-heading"><h3 class="panel-title">Number Projects expiring by year</h3></div>
				        <div class="panel-body"><div id="chart" class="chart bar" data-id="expiring"><svg style="height:200px; width:200px;"></svg></div></div>
				      </div>
				    </li>
						<li data-row="3" data-col="1" data-sizex="2" data-sizey="2">
							<div class="panel panel-default">
								<div class="panel-heading"><h3 class="panel-title">Next Year Submissions</h3></div>
								<div class="panel-body"><div id="chart6" class="chart pie" data-id="additional"><svg style="height:200px; width:200px;"></svg></div></div>
							</div>
						</li>
				  </ul>
				</div>
			</div>


					<!-- end: Content -->
			</div><!--/#content.span10-->
				</div><!--/fluid-row-->

			<div class="modal fade" id="myModal">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h4 class="modal-title">Modal title</h4>
						</div>
						<div class="modal-body">
							<p>Here settings can be configured...</p>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary">Save changes</button>
						</div>
					</div><!-- /.modal-content -->
				</div><!-- /.modal-dialog -->
			</div><!-- /.modal -->

		<div class="clearfix"></div>

		<footer>
			<p>
				<span style="text-align:left;float:left">&copy; 2014 Mobomo. <a href="http://mobomo.com">Mobomo.com</a> by Mobomo</span>
				<span class="hidden-phone" style="text-align:right;float:right">Powered by: <a href="http://bootstrapmaster.com/demo/perfectum/" alt="Bootstrap Admin Templates">Perfectum Dashboard</a></span>
			</p>
		</footer>

	</div><!--/.fluid-container-->

	<!-- start: JavaScript-->
	<!--[if !IE]>-->

			<script src="/assets/js/jquery-2.0.3.min.js"></script>

	<!--<![endif]-->

	<!--[if IE]>

		<script src="assets/js/jquery-1.10.2.min.js"></script>

	<![endif]-->

	<!--[if !IE]>-->

		<script type="text/javascript">
			window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>

	<!--<![endif]-->

	<!--[if IE]>

		<script type="text/javascript">
	 	window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
		</script>

	<![endif]-->
	<script src="assets/js/jquery-migrate-1.2.1.min.js"></script>
	<script src="assets/js/bootstrap.min.js"></script>

	<script src="/js/d3.min.js"></script>
	<script src="/js/nv.d3.min.js"></script>
	<script src="/js/jquery.gridster.min.js"></script>
	<script src="/js/jquery.gridster.with-extras.min.js"></script>
	<script src="/js/purl.js"></script>

	<script type="text/javascript">
		// ================================================= charting ==================================== //
var groupId = '<%= @group.id %>';
var categoryId = '<%= @category.id %>';
var dollarsExpiringData;
var yearExpiringData;
var statusData;
var lastUpdatedData;
var additionalSubmissionData;
$.get('/documents.json?constrain_by=all_tags', function(data){
  yearStartingData=data;
  drawPieChart(data, 'chart4');
});
$.get('/documents.json?constrain_by=year_expiring', function(data){
	// console.log(data);
  yearExpiringData = data;
  drawBarChart(data, 'chart');
  // drawPieChart(data, 'chart3', false);
});

$.get('/documents.json?constrain_by=year_expiring_dollars', function(data){
	// console.log(data);
	dollarsExpiringData = data;
  	drawBarChart(data, 'chart2');
});
$.get('/documents.json?constrain_by=status&with=Unreviewed', function(data){
	statusData = data;
	// console.log(data);
  	drawStatusPieChart(data['documents'], 'chart3');
});
$.get('/documents.json?constrain_by=last_updated', function(data){
	lastUpdatedData = data;
  drawBarChart(data['documents'], 'chart5');
});
$.get('/documents.json?constrain_by=additional_submissions', function(data){
	additionalSubmissionData = data;
	console.log(data);
		drawPieChart(data, 'chart6');
});

function drawBarChart(data,divId){
  nv.addGraph(function() {
    var chart = nv.models.discreteBarChart()
        .x(function(d) { return d.label })    //Specify the data accessors.
        .y(function(d) { return d.value })
        .staggerLabels(true)    //Too many bars and not enough room? Try staggering labels.
        .tooltips(false)        //Don't show tooltips
        .showValues(true)       //...instead, show the bar value right on top of each bar.
        .transitionDuration(1000)
        ;

    d3.select('#'+divId+' svg')
        .datum([{key: 'Cumulative Return', values: data}])
        .call(chart);

    chart.discretebar.dispatch.on('elementClick', function(e){
      // console.log('element: ' + e.value);
      console.dir(e.point);
      window.location = "/grants_page.html?constrain_by=year&with="+ e.point.label;
    });

    return chart;
  });
}

function drawPieChart(data,divId,donut){

    nv.addGraph(function() {
      var chart = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLabels(true)     //Display pie labels
      .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
      .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
      .donut(donut)          //Turn on Donut mode. Makes pie chart look tasty!
      .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
      ;

    d3.select('#'+divId+' svg')
        .datum(data)
        .transition().duration(350)
        .call(chart);

    chart.pie.dispatch.on('elementClick', function(e){
      // console.log('element: ' + e.value);
      console.dir(e.point);
      window.location = "/grants_page.html?constrain_by=tag&with="+ e.point.label;
    });

  return chart;
  });

}

function drawStatusPieChart(data,divId,donut){

    nv.addGraph(function() {
      var chart = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLabels(true)     //Display pie labels
      .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
      .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
      .donut(donut)          //Turn on Donut mode. Makes pie chart look tasty!
      .donutRatio(0.35)     //Configure how big you want the donut hole size to be.
      ;

    d3.select('#'+divId+' svg')
        .datum(data)
        .transition().duration(350)
        .call(chart);

    chart.pie.dispatch.on('elementClick', function(e){
      // console.log('element: ' + e.value);
      console.dir(e.point);
      window.location = "/grants_page.html?constrain_by=tag&with="+ e.point.label+"&review_type=unreviewed";
    });

  return chart;
  });

}

$(".gridster ul").gridster({
    widget_margins: [10, 10],
    widget_base_dimensions: [140, 140],
    resize: {
        enabled: true,
        stop: function(e, ui, $widget) {
          resizeChart($widget);
      }
    }
});

function resizeChart(widget){
  widget.find('svg').width(widget.width()-20);
  // widget.height(widget.height()-80);
  widget.find('svg').height(widget.height()-60);
  var chart = widget.find('.chart');
  if (chart.hasClass('bar')) {
    drawBarChart(getData(chart), chart.attr('id'));
  }else if(chart.hasClass('pie')){
    drawPieChart(getData(chart), chart.attr('id'), false);
  }else if(chart.hasClass('donut')){
    drawPieChart(getData(chart), chart.attr('id'), true);
  };
}

function getData(c){
  var dataType = c.attr('data-id');
  if (dataType == 'expiring'){
    return yearExpiringData;
  }else if (dataType == 'expiringDollars'){
    return dollarsExpiringData;
  }else if(dataType == 'status'){
    return statusData;
  }else if(dataType == 'additional'){
		return additionalSubmissionData;
	}else{
    return yearStartingData;
  }
}



	</script>


	<!-- page scripts -->
	<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
	<script src="assets/js/jquery.knob.modified.min.js"></script>
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="assets/js/excanvas.min.js"></script><![endif]-->
	<script src="assets/js/jquery.flot.min.js"></script>
	<script src="assets/js/jquery.flot.pie.min.js"></script>
	<script src="assets/js/jquery.flot.stack.min.js"></script>
	<script src="assets/js/jquery.flot.resize.min.js"></script>
	<script src="assets/js/jquery.flot.time.min.js"></script>
	<script src="assets/js/jquery.sparkline.min.js"></script>
	<script src="assets/js/fullcalendar.min.js"></script>
	<script src="assets/js/jquery.gritter.min.js"></script>

	<!-- theme scripts -->
	<script src="assets/js/default.min.js"></script>
	<script src="assets/js/core.min.js"></script>

	<!-- inline scripts related to this page -->
	<script src="assets/js/pages/index.js"></script>

		<!-- end: JavaScript-->

</body>
</html>
